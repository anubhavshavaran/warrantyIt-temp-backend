import { PrismaClient } from '@prisma/client';
import { v4 as uuidv4 } from 'uuid';

const prisma = new PrismaClient();

const handleRegisterProduct = async (req, res) => {
  try {
    const {
      firstname,
      lastname,
      email,
      phone,
      productname,
      producttype,
      purchasedate,
      serialnumber,
      productbrand,
      billimage
    } = req.body;

    const buyerId = "080611ae-5c01-42f8-bf93-6a145f4e7904"; // To be taken from user's login cookies
    const productId = uuidv4(); // To be generated by the Postgres

    const registeredProduct = await prisma.product.create({
      data: {
        productId: productId,
        buyerId: "U001",
        buyerFirstName: firstname,
        buyerLastName: lastname,
        buyerEmailId: email,
        buyerPhoneNumber: phone,
        productName: productname,
        productType: producttype,
        productPurchaseDate: purchasedate,
        productSerialNumber: serialnumber,
        productBrand: productbrand,
        productImageUrl: billimage
      },
    });

    return res.status(200).json({
      message: "Product created successfully",
      status: true,
      data: {
        registeredProduct
      }
    });

  } catch (error) {
    console.error(error);
    return res.status(500).json({
      message: "Something went wrong while registering the product",
      status: false,
    });
  }
};

export {
  handleRegisterProduct,
};